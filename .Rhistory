mutate(Response=case_when(nchar(Response)>2&Score==Score_idt~Response_idt,
nchar(Response)>2&Score!=Score_idt~NA,
nchar(Response)>2&is.na(Score)~NA,
nchar(Response)>2&is.na(Score_idt)~NA,
.default=Response))%>%
select(-c('Score_idt','Response_idt'))%>%
pivot_longer(c(Score,ResponseTime,Response),names_to='key',values_to='value')%>%
pivot_wider(names_from=item_id,values_from=value),by=c('ExamineeID','Study')),
'LSWM'=lswm_ids%>%
left_join(check_v3_matching%>%
filter(str_detect(instrument_title,'LSWM'))%>%
pivot_wider(names_from=item_id,values_from=value),by=c('ExamineeID','Study')),
'PSM'=psm_ids%>%
left_join(check_v3_matching%>%
filter(str_detect(instrument_title,'Picture Sequence'))%>%
filter(str_detect(instrument_title,'Self-Administered',negate=T))%>%
pivot_wider(names_from=item_id,values_from=value),by=c('ExamineeID','Study')),
'PV'=pv_ids%>%
left_join(check_v3_matching%>%
filter(str_detect(instrument_title,'Picture Vocabulary'))%>%
filter(str_detect(instrument_title,'Practice',negate=T))%>%
pivot_wider(names_from=item_id,values_from=value),by=c('ExamineeID','Study')),
'ORR'=orr_ids%>%
left_join(check_v3_matching%>%
filter(str_detect(instrument_title,'Oral Reading'))%>%
pivot_wider(names_from=item_id,values_from=value),by=c('ExamineeID','Study')),
'VR'=vr_ids%>%
left_join(check_v3_matching%>%
filter(str_detect(instrument_title,'Visual Reasoning'))%>%
pivot_wider(names_from=item_id,values_from=value),by=c('ExamineeID','Study')),
'RAVLT'=ravlt_ids%>%
left_join(check_v3_matching%>%
filter(str_detect(instrument_title,'Rey'))%>%
filter(str_detect(instrument_title,'Delay',negate=T))%>%
pivot_wider(names_from=item_id,values_from=value),by=c('ExamineeID','Study')),
'RAVLT Delay'=ravlt_delay_ids%>%
left_join(check_v3_matching%>%
filter(str_detect(instrument_title,'Rey'))%>%
filter(str_detect(instrument_title,'Delay'))%>%
pivot_wider(names_from=item_id,values_from=value),by=c('ExamineeID','Study')),
'OSD'=osd_ids%>%
left_join(check_v3_matching%>%
filter(str_detect(instrument_title,'Oral Symbol'))%>%
pivot_wider(names_from=item_id,values_from=value),by=c('ExamineeID','Study')),
'SM'=sm_ids%>%
left_join(check_v3_matching%>%
filter(str_detect(instrument_title,'Speeded Matching'))%>%
pivot_wider(names_from=key,values_from=value)%>%
left_join(sm_idt,by=c('item_id'='ItemID'))%>%
mutate(Response=case_when(nchar(Response)>2&Score==Score_idt~Response_idt,
nchar(Response)>2&Score!=Score_idt~NA,
nchar(Response)>2&is.na(Score)~NA,
nchar(Response)>2&is.na(Score_idt)~NA,
.default=Response))%>%
select(-c('Score_idt','Response_idt'))%>%
pivot_longer(c(Score,ResponseTime,Response),names_to='key',values_to='value')%>%
pivot_wider(names_from=item_id,values_from=value),by=c('ExamineeID','Study')),
'PC'=pc_ids%>%
left_join(check_v3_matching%>%
filter(str_detect(instrument_title,'Pattern Comparison'))%>%
filter(str_detect(instrument_title,'Practice',negate=T))%>%
pivot_wider(names_from=key,values_from=value)%>%
left_join(pc_idt,by=c('item_id'='ItemID'))%>%
mutate(Response=case_when(nchar(Response)>2&Score==Score_idt~Response_idt,
nchar(Response)>2&Score!=Score_idt~NA,
nchar(Response)>2&is.na(Score)~NA,
nchar(Response)>2&is.na(Score_idt)~NA,
.default=Response))%>%
select(-c('Score_idt','Response_idt'))%>%
pivot_longer(c(Score,ResponseTime,Response),names_to='key',values_to='value')%>%
pivot_wider(names_from=item_id,values_from=value),by=c('ExamineeID','Study')),
# 'FNAME'=fname_ids%>%
#   left_join(check_v3_matching%>%
#               filter(str_detect(instrument_title,'FNAME Learning'))%>%
#               pivot_wider(names_from=item_id,values_from=value),by=c('ExamineeID','Study')),
'FNAME Delay'=fname_delay_ids%>%
left_join(check_v3_matching%>%
filter(str_detect(instrument_title,'FNAME Test'))%>%
select(-instrument_title)%>%
pivot_wider(names_from=item_id,values_from=value)%>%
mutate(instrument_title='NIH Toolbox FNAME Test (FSB, FNL, FNM combined)'),by=c('ExamineeID','Study'))
)
View(v3_item_data_list$DCCS)
# check response imputation 2025-11-21
v3_item_data_list$DCCS%>%
filter(key=='Response')%>%
pivot_longer(-c(1:4),names_to='item_id',values_to='response')%>%View()
# check response imputation 2025-11-21
v3_item_data_list$DCCS%>%
filter(key=='Response')%>%
pivot_longer(-c(1:4),names_to='item_id',values_to='response')%>%
filter(nchar(response)>2)%>%View()
v3_item_data_list$SM%>%
filter(key=='Response')%>%
pivot_longer(-c(1:4),names_to='item_id',values_to='response')%>%
filter(nchar(response)>2)
v3_item_data_list$PC%>%
filter(key=='Response')%>%
pivot_longer(-c(1:4),names_to='item_id',values_to='response')%>%
filter(nchar(response)>2)
# pull item level data into list for output
v3_item_data_list<-list('Flanker'=flanker_ids%>%
left_join(check_v3_matching%>%
filter(str_detect(instrument_title,'Flanker'))%>%
pivot_wider(names_from=item_id,values_from=value),by=c('ExamineeID','Study')),
'DCCS'=dccs_ids%>%
left_join(check_v3_matching%>%
filter(str_detect(instrument_title,'Dimensional'))%>%
filter(str_detect(instrument_title,'Self-Administered',negate=T))%>%
# pivot_wider(names_from=key,values_from=value)%>%
# left_join(dccs_idt,by=c('item_id'='ItemID'))%>%
# mutate(Response=case_when(nchar(Response)>2&Score==Score_idt~Response_idt,
#                            nchar(Response)>2&Score!=Score_idt~NA,
#                            nchar(Response)>2&is.na(Score)~NA,
#                            nchar(Response)>2&is.na(Score_idt)~NA,
#                            .default=Response))%>%
# select(-c('Score_idt','Response_idt'))%>%
# pivot_longer(c(Score,ResponseTime,Response),names_to='key',values_to='value')%>%
pivot_wider(names_from=item_id,values_from=value),by=c('ExamineeID','Study')),
'LSWM'=lswm_ids%>%
left_join(check_v3_matching%>%
filter(str_detect(instrument_title,'LSWM'))%>%
pivot_wider(names_from=item_id,values_from=value),by=c('ExamineeID','Study')),
'PSM'=psm_ids%>%
left_join(check_v3_matching%>%
filter(str_detect(instrument_title,'Picture Sequence'))%>%
filter(str_detect(instrument_title,'Self-Administered',negate=T))%>%
pivot_wider(names_from=item_id,values_from=value),by=c('ExamineeID','Study')),
'PV'=pv_ids%>%
left_join(check_v3_matching%>%
filter(str_detect(instrument_title,'Picture Vocabulary'))%>%
filter(str_detect(instrument_title,'Practice',negate=T))%>%
pivot_wider(names_from=item_id,values_from=value),by=c('ExamineeID','Study')),
'ORR'=orr_ids%>%
left_join(check_v3_matching%>%
filter(str_detect(instrument_title,'Oral Reading'))%>%
pivot_wider(names_from=item_id,values_from=value),by=c('ExamineeID','Study')),
'VR'=vr_ids%>%
left_join(check_v3_matching%>%
filter(str_detect(instrument_title,'Visual Reasoning'))%>%
pivot_wider(names_from=item_id,values_from=value),by=c('ExamineeID','Study')),
'RAVLT'=ravlt_ids%>%
left_join(check_v3_matching%>%
filter(str_detect(instrument_title,'Rey'))%>%
filter(str_detect(instrument_title,'Delay',negate=T))%>%
pivot_wider(names_from=item_id,values_from=value),by=c('ExamineeID','Study')),
'RAVLT Delay'=ravlt_delay_ids%>%
left_join(check_v3_matching%>%
filter(str_detect(instrument_title,'Rey'))%>%
filter(str_detect(instrument_title,'Delay'))%>%
pivot_wider(names_from=item_id,values_from=value),by=c('ExamineeID','Study')),
'OSD'=osd_ids%>%
left_join(check_v3_matching%>%
filter(str_detect(instrument_title,'Oral Symbol'))%>%
pivot_wider(names_from=item_id,values_from=value),by=c('ExamineeID','Study')),
'SM'=sm_ids%>%
left_join(check_v3_matching%>%
filter(str_detect(instrument_title,'Speeded Matching'))%>%
pivot_wider(names_from=key,values_from=value)%>%
left_join(sm_idt,by=c('item_id'='ItemID'))%>%
mutate(Response=case_when(nchar(Response)>2&Score==Score_idt~Response_idt,
nchar(Response)>2&Score!=Score_idt~NA,
nchar(Response)>2&is.na(Score)~NA,
nchar(Response)>2&is.na(Score_idt)~NA,
.default=Response))%>%
select(-c('Score_idt','Response_idt'))%>%
pivot_longer(c(Score,ResponseTime,Response),names_to='key',values_to='value')%>%
pivot_wider(names_from=item_id,values_from=value),by=c('ExamineeID','Study')),
'PC'=pc_ids%>%
left_join(check_v3_matching%>%
filter(str_detect(instrument_title,'Pattern Comparison'))%>%
filter(str_detect(instrument_title,'Practice',negate=T))%>%
pivot_wider(names_from=key,values_from=value)%>%
left_join(pc_idt,by=c('item_id'='ItemID'))%>%
mutate(Response=case_when(nchar(Response)>2&Score==Score_idt~Response_idt,
nchar(Response)>2&Score!=Score_idt~NA,
nchar(Response)>2&is.na(Score)~NA,
nchar(Response)>2&is.na(Score_idt)~NA,
.default=Response))%>%
select(-c('Score_idt','Response_idt'))%>%
pivot_longer(c(Score,ResponseTime,Response),names_to='key',values_to='value')%>%
pivot_wider(names_from=item_id,values_from=value),by=c('ExamineeID','Study')),
# 'FNAME'=fname_ids%>%
#   left_join(check_v3_matching%>%
#               filter(str_detect(instrument_title,'FNAME Learning'))%>%
#               pivot_wider(names_from=item_id,values_from=value),by=c('ExamineeID','Study')),
'FNAME Delay'=fname_delay_ids%>%
left_join(check_v3_matching%>%
filter(str_detect(instrument_title,'FNAME Test'))%>%
select(-instrument_title)%>%
pivot_wider(names_from=item_id,values_from=value)%>%
mutate(instrument_title='NIH Toolbox FNAME Test (FSB, FNL, FNM combined)'),by=c('ExamineeID','Study'))
)
# check response imputation 2025-11-21
v3_item_data_list$DCCS%>%
filter(key=='Response')%>%
pivot_longer(-c(1:4),names_to='item_id',values_to='response')%>%
filter(nchar(response)>2)
# pull item level data into list for output
v3_item_data_list<-list('Flanker'=flanker_ids%>%
left_join(check_v3_matching%>%
filter(str_detect(instrument_title,'Flanker'))%>%
pivot_wider(names_from=item_id,values_from=value),by=c('ExamineeID','Study')),
'DCCS'=dccs_ids%>%
left_join(check_v3_matching%>%
filter(str_detect(instrument_title,'Dimensional'))%>%
filter(str_detect(instrument_title,'Self-Administered',negate=T))%>%
pivot_wider(names_from=key,values_from=value)%>%
left_join(dccs_idt,by=c('item_id'='ItemID'))%>%
mutate(Response=case_when(nchar(Response)>2&Score==Score_idt~Response_idt,
nchar(Response)>2&Score!=Score_idt~NA,
nchar(Response)>2&is.na(Score)~NA,
nchar(Response)>2&is.na(Score_idt)~NA,
.default=Response))%>%
select(-c('Score_idt','Response_idt'))%>%
pivot_longer(c(Score,ResponseTime,Response),names_to='key',values_to='value')%>%
pivot_wider(names_from=item_id,values_from=value),by=c('ExamineeID','Study')),
'LSWM'=lswm_ids%>%
left_join(check_v3_matching%>%
filter(str_detect(instrument_title,'LSWM'))%>%
pivot_wider(names_from=item_id,values_from=value),by=c('ExamineeID','Study')),
'PSM'=psm_ids%>%
left_join(check_v3_matching%>%
filter(str_detect(instrument_title,'Picture Sequence'))%>%
filter(str_detect(instrument_title,'Self-Administered',negate=T))%>%
pivot_wider(names_from=item_id,values_from=value),by=c('ExamineeID','Study')),
'PV'=pv_ids%>%
left_join(check_v3_matching%>%
filter(str_detect(instrument_title,'Picture Vocabulary'))%>%
filter(str_detect(instrument_title,'Practice',negate=T))%>%
pivot_wider(names_from=item_id,values_from=value),by=c('ExamineeID','Study')),
'ORR'=orr_ids%>%
left_join(check_v3_matching%>%
filter(str_detect(instrument_title,'Oral Reading'))%>%
pivot_wider(names_from=item_id,values_from=value),by=c('ExamineeID','Study')),
'VR'=vr_ids%>%
left_join(check_v3_matching%>%
filter(str_detect(instrument_title,'Visual Reasoning'))%>%
pivot_wider(names_from=item_id,values_from=value),by=c('ExamineeID','Study')),
'RAVLT'=ravlt_ids%>%
left_join(check_v3_matching%>%
filter(str_detect(instrument_title,'Rey'))%>%
filter(str_detect(instrument_title,'Delay',negate=T))%>%
pivot_wider(names_from=item_id,values_from=value),by=c('ExamineeID','Study')),
'RAVLT Delay'=ravlt_delay_ids%>%
left_join(check_v3_matching%>%
filter(str_detect(instrument_title,'Rey'))%>%
filter(str_detect(instrument_title,'Delay'))%>%
pivot_wider(names_from=item_id,values_from=value),by=c('ExamineeID','Study')),
'OSD'=osd_ids%>%
left_join(check_v3_matching%>%
filter(str_detect(instrument_title,'Oral Symbol'))%>%
pivot_wider(names_from=item_id,values_from=value),by=c('ExamineeID','Study')),
'SM'=sm_ids%>%
left_join(check_v3_matching%>%
filter(str_detect(instrument_title,'Speeded Matching'))%>%
pivot_wider(names_from=key,values_from=value)%>%
left_join(sm_idt,by=c('item_id'='ItemID'))%>%
mutate(Response=case_when(nchar(Response)>2&Score==Score_idt~Response_idt,
nchar(Response)>2&Score!=Score_idt~NA,
nchar(Response)>2&is.na(Score)~NA,
nchar(Response)>2&is.na(Score_idt)~NA,
.default=Response))%>%
select(-c('Score_idt','Response_idt'))%>%
pivot_longer(c(Score,ResponseTime,Response),names_to='key',values_to='value')%>%
pivot_wider(names_from=item_id,values_from=value),by=c('ExamineeID','Study')),
'PC'=pc_ids%>%
left_join(check_v3_matching%>%
filter(str_detect(instrument_title,'Pattern Comparison'))%>%
filter(str_detect(instrument_title,'Practice',negate=T))%>%
pivot_wider(names_from=key,values_from=value)%>%
left_join(pc_idt,by=c('item_id'='ItemID'))%>%
mutate(Response=case_when(nchar(Response)>2&Score==Score_idt~Response_idt,
nchar(Response)>2&Score!=Score_idt~NA,
nchar(Response)>2&is.na(Score)~NA,
nchar(Response)>2&is.na(Score_idt)~NA,
.default=Response))%>%
select(-c('Score_idt','Response_idt'))%>%
pivot_longer(c(Score,ResponseTime,Response),names_to='key',values_to='value')%>%
pivot_wider(names_from=item_id,values_from=value),by=c('ExamineeID','Study')),
# 'FNAME'=fname_ids%>%
#   left_join(check_v3_matching%>%
#               filter(str_detect(instrument_title,'FNAME Learning'))%>%
#               pivot_wider(names_from=item_id,values_from=value),by=c('ExamineeID','Study')),
'FNAME Delay'=fname_delay_ids%>%
left_join(check_v3_matching%>%
filter(str_detect(instrument_title,'FNAME Test'))%>%
select(-instrument_title)%>%
pivot_wider(names_from=item_id,values_from=value)%>%
mutate(instrument_title='NIH Toolbox FNAME Test (FSB, FNL, FNM combined)'),by=c('ExamineeID','Study'))
)
library(tidyverse)
library(janitor)
library(arrow)
library(readxl)
v3_file_list<-list.files("/Volumes/NIHTB v3.0 Norming/SG Data/Cleaned_Data/2022_04_08",pattern=".parq")
v3_datalink<-arrow::open_dataset(paste("/Volumes/NIHTB v3.0 Norming/SG Data/Cleaned_Data/2022_04_08",v3_file_list[1],sep="/"))
# item description tables
sm_idt<-read_xlsx('/Volumes/NIHTB v3.0 Norming/Master Data/For external/Item level data/item description tables/SM_idt.xlsx')
pc_idt<-read_xlsx('/Volumes/NIHTB v3.0 Norming/Master Data/For external/Item level data/item description tables/PC_idt.xlsx')
dccs_idt<-read_xlsx('/Volumes/NIHTB v3.0 Norming/Master Data/For external/Item level data/item description tables/DCCS_idt.xlsx')
sm_idt<-sm_idt%>%
separate(`Responses (each choice separated by | character)`,into=paste0('value',c(1:10)),'[|]+')%>%
pivot_longer(contains(c('value')))%>%
mutate(value=trimws(value))%>%
separate(value,into=c('Response','Description','Score'),'[=]+')%>%
select(c('Item ID (Variable Name)','Response','Score'))%>%
mutate(Score=trimws(Score),
Response=trimws(Response))%>%
subset(Score=='1')%>%
rename(ItemID=`Item ID (Variable Name)`,
Score_idt=Score,
Response_idt=Response)
pc_idt<-pc_idt%>%
separate(`Responses (each choice separated by | character)`,into=paste0('value',c(1:10)),'[|]+')%>%
pivot_longer(contains(c('value')))%>%
mutate(value=trimws(value))%>%
separate(value,into=c('Response','Description','Score'),'[=]+')%>%
select(c('Item ID (Variable Name)','Response','Score'))%>%
mutate(Score=trimws(Score),
Response=trimws(Response))%>%
subset(Score=='1')%>%
rename(ItemID=`Item ID (Variable Name)`,
Score_idt=Score,
Response_idt=Response)
dccs_idt<-dccs_idt%>%
separate(`Responses (each choice separated by | character)`,into=paste0('value',c(1:10)),'[|]+')%>%
pivot_longer(contains(c('value')))%>%
mutate(value=trimws(value))%>%
separate(value,into=c('Response','Description','Score'),'[=]+')%>%
select(c('Item ID (Variable Name)','Response','Score'))%>%
mutate(Score=trimws(Score),
Response=trimws(Response))%>%
subset(Score=='1')%>%
rename(ItemID=`Item ID (Variable Name)`,
Score_idt=Score,
Response_idt=Response)
# data 18 and under
v3_master_public<-read.csv('/Volumes/NIHTB v3.0 Norming/Master Data/For external/V3_Master_Public_ForRT_2025-09-05.csv') # master spreadsheet
check_v3_matching<-v3_datalink%>%
collect()%>%
clean_names()%>%
rename(ExamineeID=final_pin)%>%
select(c(ExamineeID,instrument_title,item_id,key,value,retest_order))%>%
subset(key=='Score'|key=='Response'|key=='ResponseTime')%>%
mutate(Study=case_when(retest_order=='FALSE'~'Norming',
retest_order=='first'~'Norming',
retest_order=='second'~'retest'))%>%
select(-retest_order)
# check_v3_matching%>%distinct(instrument_title)%>%View()
# create list of examinees by measure - exclude item level data for individuals who don't have a CSS
flanker_ids<-v3_master_public%>%subset(Task=='Flanker')%>%filter(!is.na(CSS))%>%select(c(ExamineeID,Study))
dccs_ids<-v3_master_public%>%subset(Task=='DCCS')%>%filter(!is.na(CSS))%>%select(c(ExamineeID,Study))
lswm_ids<-v3_master_public%>%subset(Task=='LSWM')%>%filter(!is.na(CSS))%>%select(c(ExamineeID,Study))
psm_ids<-v3_master_public%>%subset(Task=='PSM')%>%filter(!is.na(CSS))%>%select(c(ExamineeID,Study))
pv_ids<-v3_master_public%>%subset(Task=='PV')%>%filter(!is.na(CSS))%>%select(c(ExamineeID,Study))
orr_ids<-v3_master_public%>%subset(Task=='ORR')%>%filter(!is.na(CSS))%>%select(c(ExamineeID,Study))
vr_ids<-v3_master_public%>%subset(Task=='VR')%>%filter(!is.na(CSS))%>%select(c(ExamineeID,Study))
ravlt_ids<-v3_master_public%>%subset(Task=='RAVLT')%>%filter(!is.na(CSS))%>%select(c(ExamineeID,Study))
ravlt_delay_ids<-v3_master_public%>%subset(Task=='RAVLT Delay')%>%filter(!is.na(CSS))%>%select(c(ExamineeID,Study))
osd_ids<-v3_master_public%>%subset(Task=='OSD')%>%filter(!is.na(CSS))%>%select(c(ExamineeID,Study))
sm_ids<-v3_master_public%>%subset(Task=='SM')%>%filter(!is.na(CSS))%>%select(c(ExamineeID,Study))
pc_ids<-v3_master_public%>%subset(Task=='PC')%>%filter(!is.na(CSS))%>%select(c(ExamineeID,Study))
fname_ids<-v3_master_public%>%subset(Task=='FNAME')%>%filter(!is.na(CSS))%>%select(c(ExamineeID,Study))
fname_delay_ids<-v3_master_public%>%subset(Task=='FNAME Delay')%>%filter(!is.na(CSS))%>%select(c(ExamineeID,Study))
# pull item level data into list for output
v3_item_data_list<-list('Flanker'=flanker_ids%>%
left_join(check_v3_matching%>%
filter(str_detect(instrument_title,'Flanker'))%>%
pivot_wider(names_from=item_id,values_from=value),by=c('ExamineeID','Study')),
'DCCS'=dccs_ids%>%
left_join(check_v3_matching%>%
filter(str_detect(instrument_title,'Dimensional'))%>%
filter(str_detect(instrument_title,'Self-Administered',negate=T))%>%
pivot_wider(names_from=key,values_from=value)%>%
left_join(dccs_idt,by=c('item_id'='ItemID'))%>%
mutate(Response=case_when(nchar(Response)>2&Score==Score_idt~Response_idt,
nchar(Response)>2&Score!=Score_idt~NA,
nchar(Response)>2&is.na(Score)~NA,
nchar(Response)>2&is.na(Score_idt)~NA,
.default=Response))%>%
select(-c('Score_idt','Response_idt'))%>%
pivot_longer(c(Score,ResponseTime,Response),names_to='key',values_to='value')%>%
pivot_wider(names_from=item_id,values_from=value),by=c('ExamineeID','Study')),
'LSWM'=lswm_ids%>%
left_join(check_v3_matching%>%
filter(str_detect(instrument_title,'LSWM'))%>%
pivot_wider(names_from=item_id,values_from=value),by=c('ExamineeID','Study')),
'PSM'=psm_ids%>%
left_join(check_v3_matching%>%
filter(str_detect(instrument_title,'Picture Sequence'))%>%
filter(str_detect(instrument_title,'Self-Administered',negate=T))%>%
pivot_wider(names_from=item_id,values_from=value),by=c('ExamineeID','Study')),
'PV'=pv_ids%>%
left_join(check_v3_matching%>%
filter(str_detect(instrument_title,'Picture Vocabulary'))%>%
filter(str_detect(instrument_title,'Practice',negate=T))%>%
pivot_wider(names_from=item_id,values_from=value),by=c('ExamineeID','Study')),
'ORR'=orr_ids%>%
left_join(check_v3_matching%>%
filter(str_detect(instrument_title,'Oral Reading'))%>%
pivot_wider(names_from=item_id,values_from=value),by=c('ExamineeID','Study')),
'VR'=vr_ids%>%
left_join(check_v3_matching%>%
filter(str_detect(instrument_title,'Visual Reasoning'))%>%
pivot_wider(names_from=item_id,values_from=value),by=c('ExamineeID','Study')),
'RAVLT'=ravlt_ids%>%
left_join(check_v3_matching%>%
filter(str_detect(instrument_title,'Rey'))%>%
filter(str_detect(instrument_title,'Delay',negate=T))%>%
pivot_wider(names_from=item_id,values_from=value),by=c('ExamineeID','Study')),
'RAVLT Delay'=ravlt_delay_ids%>%
left_join(check_v3_matching%>%
filter(str_detect(instrument_title,'Rey'))%>%
filter(str_detect(instrument_title,'Delay'))%>%
pivot_wider(names_from=item_id,values_from=value),by=c('ExamineeID','Study')),
'OSD'=osd_ids%>%
left_join(check_v3_matching%>%
filter(str_detect(instrument_title,'Oral Symbol'))%>%
pivot_wider(names_from=item_id,values_from=value),by=c('ExamineeID','Study')),
'SM'=sm_ids%>%
left_join(check_v3_matching%>%
filter(str_detect(instrument_title,'Speeded Matching'))%>%
pivot_wider(names_from=key,values_from=value)%>%
left_join(sm_idt,by=c('item_id'='ItemID'))%>%
mutate(Response=case_when(nchar(Response)>2&Score==Score_idt~Response_idt,
nchar(Response)>2&Score!=Score_idt~NA,
nchar(Response)>2&is.na(Score)~NA,
nchar(Response)>2&is.na(Score_idt)~NA,
.default=Response))%>%
select(-c('Score_idt','Response_idt'))%>%
pivot_longer(c(Score,ResponseTime,Response),names_to='key',values_to='value')%>%
pivot_wider(names_from=item_id,values_from=value),by=c('ExamineeID','Study')),
'PC'=pc_ids%>%
left_join(check_v3_matching%>%
filter(str_detect(instrument_title,'Pattern Comparison'))%>%
filter(str_detect(instrument_title,'Practice',negate=T))%>%
pivot_wider(names_from=key,values_from=value)%>%
left_join(pc_idt,by=c('item_id'='ItemID'))%>%
mutate(Response=case_when(nchar(Response)>2&Score==Score_idt~Response_idt,
nchar(Response)>2&Score!=Score_idt~NA,
nchar(Response)>2&is.na(Score)~NA,
nchar(Response)>2&is.na(Score_idt)~NA,
.default=Response))%>%
select(-c('Score_idt','Response_idt'))%>%
pivot_longer(c(Score,ResponseTime,Response),names_to='key',values_to='value')%>%
pivot_wider(names_from=item_id,values_from=value),by=c('ExamineeID','Study')),
# 'FNAME'=fname_ids%>%
#   left_join(check_v3_matching%>%
#               filter(str_detect(instrument_title,'FNAME Learning'))%>%
#               pivot_wider(names_from=item_id,values_from=value),by=c('ExamineeID','Study')),
'FNAME Delay'=fname_delay_ids%>%
left_join(check_v3_matching%>%
filter(str_detect(instrument_title,'FNAME Test'))%>%
select(-instrument_title)%>%
pivot_wider(names_from=item_id,values_from=value)%>%
mutate(instrument_title='NIH Toolbox FNAME Test (FSB, FNL, FNM combined)'),by=c('ExamineeID','Study'))
)
# check response imputation 2025-11-21
v3_item_data_list$DCCS%>%
filter(key=='Response')%>%
pivot_longer(-c(1:4),names_to='item_id',values_to='response')%>%
filter(nchar(response)>2)
v3_item_data_list$SM%>%
filter(key=='Response')%>%
pivot_longer(-c(1:4),names_to='item_id',values_to='response')%>%
filter(nchar(response)>2)
v3_item_data_list$PC%>%
filter(key=='Response')%>%
pivot_longer(-c(1:4),names_to='item_id',values_to='response')%>%
filter(nchar(response)>2)
# export to xlsx
openxlsx::write.xlsx(v3_item_data_list,file=paste0('/Volumes/NIHTB v3.0 Norming/Master Data/For external/Item level data/V3_Item_Level_ForRT_',Sys.Date(),'.xlsx'))
length(v3_item_data_list)
names(v3_item_data_list)[1]
v3_item_data_list[[i]]%>%
filter(key=='Response')%>%
pivot_longer(-c(1:4),names_to='item_id',values_to='response')%>%
filter(nchar(response)>2)
i=1
v3_item_data_list[[i]]%>%
filter(key=='Response')%>%
pivot_longer(-c(1:4),names_to='item_id',values_to='response')%>%
filter(nchar(response)>2)
# check response imputation 2025-11-21
for(i in 1:length(v3_item_data_list)){
print(names(v3_item_data_list)[i])
print(v3_item_data_list[[i]]%>%
filter(key=='Response')%>%
pivot_longer(-c(1:4),names_to='item_id',values_to='response')%>%
filter(nchar(response)>2))
}
View(v3_item_data_list$`FNAME Delay`)
check_v3_matching%>%
filter(str_detect(instrument_title,'Speeded Matching'))%>%
pivot_wider(names_from=key,values_from=value)%>%
left_join(sm_idt,by=c('item_id'='ItemID'))%>%
mutate(Response2=case_when(nchar(Response)>2&Score==Score_idt~Response_idt,
nchar(Response)>2&Score!=Score_idt~NA,
nchar(Response)>2&is.na(Score)~NA,
nchar(Response)>2&is.na(Score_idt)~NA,
.default=Response))%>%View()
check_v3_matching%>%
filter(str_detect(instrument_title,'Speeded Matching'))%>%
pivot_wider(names_from=key,values_from=value)%>%
left_join(sm_idt,by=c('item_id'='ItemID'))%>%
mutate(Response2=case_when(nchar(Response)>2&Score==Score_idt~Response_idt,
nchar(Response)>2&Score!=Score_idt~NA,
nchar(Response)>2&is.na(Score)~NA,
nchar(Response)>2&is.na(Score_idt)~NA,
.default=Response))%>%filter(nchar(Response)>2)%>%View()
View(v3_item_data_list$SM)
